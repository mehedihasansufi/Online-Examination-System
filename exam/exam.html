<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Examination System</title>
    <link rel="stylesheet" href="./exam.css">
</head>
<body>
    <header>
        <img height="50px" src="../images/logo.png" alt="logo">
        <nav class="navigation">
             <a href="../Student/student.html">Home</a>
            <a href="">About</a>
            <a href="">Service</a>
            <a href="">Contract</a>
            <!-- <button class="btn">Login</button> -->
        </nav>
    </header>

    <main>
        <h2 id="exam-title" style="text-align:center; margin:20px 0;">Exam Title</h2>
        <form id="exam-form">
            <div id="questions-container"></div>
            <div style="text-align:center; margin:20px;">
                <button type="submit" class="btn">Submit Exam</button>
            </div>
        </form>
    </main>

    <footer>
        <p>Developed by Mehedi Hasan | Sazzad Shahriar</p>
    </footer>

  <script>
    // Get exam_name from URL
    const urlParams = new URLSearchParams(window.location.search);
    const examName = urlParams.get('exam_name');
    document.getElementById('exam-title').innerText = examName || "Exam";

    // Fetch questions
    fetch(`../Student/fetch_questions.php?exam_name=${encodeURIComponent(examName)}`)
    .then(response => response.json())
    .then(data => {
        const container = document.getElementById('questions-container');
        container.innerHTML = '';

        if (!data || data.length === 0) {
            container.innerHTML = "<p>No questions found for this exam.</p>";
            return;
        }

        data.forEach((q, index) => {
            const div = document.createElement('div');
            div.classList.add('question-card');
            div.innerHTML = `
                <p><b>Q${index + 1}: ${q.question_text}</b></p>
                <label><input type="radio" name="q${q.id}" value="${q.option1}"> ${q.option1}</label><br>
                <label><input type="radio" name="q${q.id}" value="${q.option2}"> ${q.option2}</label><br>
                <label><input type="radio" name="q${q.id}" value="${q.option3}"> ${q.option3}</label><br>
                <label><input type="radio" name="q${q.id}" value="${q.option4}"> ${q.option4}</label><br><br>
            `;
            container.appendChild(div);
        });
    })
    .catch(error => {
        console.error('Error fetching questions:', error);
        document.getElementById('questions-container').innerHTML = "<p>Error loading questions.</p>";
    });

    // Submit exam
    document.getElementById('exam-form').addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent page reload

        const formData = new FormData(this);
        formData.append('exam', examName); // Send exam name to PHP

        fetch('../Student/submit_exam.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(result => {
            alert(result); // Show score in popup
            // Optionally, reset the form if needed:
            // document.getElementById('exam-form').reset();
        })
        .catch(error => {
            console.error('Error submitting exam:', error);
            alert('Error submitting exam');
        });
    });
</script>

</body>
</html>
