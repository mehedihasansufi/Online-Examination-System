<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Examination System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./exam.css">
</head>

<body>
    <header>
        <h2 class="logo">Logo</h2>
        <nav class="navigation">
            <a href="">About</a>
            <a href="">Service</a>
            <a href="">Contract</a>
            <button class="btn">Login</button>
        </nav>
    </header>

    <main>
        <h2 id="exam-title" style="text-align:center; margin:20px 0;">Exam Title</h2>
        <form id="exam-form">
            <div id="questions-container"></div>
            <div style="text-align:center; margin:20px;">
                <button type="submit" class="btn">Submit Exam</button>
            </div>
        </form>
    </main>

    <footer>
        <div class="display-all">
            <div class="main footer__for-flex">
                <h4>Main</h4>
                <a href="">Home</a>
                <a href="">Contact</a>
                <a href="">Work With Us</a>
                <a href="">My Gear</a>
            </div>
            <div class="learn footer__for-flex">
                <h4>Learn</h4>
                <a href="">Courses</a>
                <a href="">Tutorials</a>
                <a href="">Notes</a>
            </div>
            <div class="legal footer__for-flex">
                <h4>Legal</h4>
                <a href="">Terms</a>
                <a href="">Privacy</a>
                <a href="">Refund</a>
            </div>
            <div class="footer__follow footer__for-flex">
                <h4>Follow Us</h4>
                <a href="https://github.com/mehedihasansufi" target="_blank"><i class="fa-brands fa-github"></i> Github</a>
                <a href="https://www.facebook.com/sazzad.shahriar.66"><i class="fa-brands fa-facebook-f"></i> Facebook</a>
                <a href=""><i class="fa-brands fa-x-twitter"></i> Twitter</a>
            </div>
        </div>
        <div class="develop-mehedi">
            <p>Develop &hearts; with </p>
            <p>copyright &copy; 2025</p>
            <p>Developed by Mehedi Hasan | Sazzad shahriar</p>
        </div>
    </footer>

    <script>
        // 1️⃣ Get exam name from URL
        const urlParams = new URLSearchParams(window.location.search);
        const examName = urlParams.get('exam_name'); // <-- must match fetch_questions.php param
        document.getElementById('exam-title').innerText = examName || "Exam";

        // 2️⃣ Load questions
        fetch(`../Student/fetch_questions.php?exam_name=${encodeURIComponent(examName)}`)
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('questions-container');
                container.innerHTML = '';

                if (!data || data.length === 0) {
                    container.innerHTML = "<p>No questions found for this exam.</p>";
                    return;
                }

                data.forEach((q, index) => {
                    const div = document.createElement('div');
                    div.classList.add('question-card');
                    div.innerHTML = `
                        <p><b>Q${index + 1}: ${q.question_text}</b></p>
                        <label><input type="radio" name="q${q.id}" value="${q.option1}"> ${q.option1}</label><br>
                        <label><input type="radio" name="q${q.id}" value="${q.option2}"> ${q.option2}</label><br>
                        <label><input type="radio" name="q${q.id}" value="${q.option3}"> ${q.option3}</label><br>
                        <label><input type="radio" name="q${q.id}" value="${q.option4}"> ${q.option4}</label><br><br>
                    `;
                    container.appendChild(div);
                });
            })
            .catch(err => {
                console.error("Fetch error:", err);
                document.getElementById('questions-container').innerHTML = "<p>Error loading questions.</p>";
            });

        // 3️⃣ Submit exam
        document.getElementById('exam-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            formData.append('exam_name', examName); // match PHP param

            fetch('../Student/submit_exam.php', {
                method: 'POST',
                body: formData
            })
                .then(res => res.text())
                .then(result => {
                    alert(result);
                    window.location.href = '../student/student.html';
                })
                .catch(err => {
                    console.error("Submit error:", err);
                    alert('Error submitting exam');
                });
        });
    </script>
</body>

</html>
